<h3>注文履歴詳細</h3>

<div>
  <table>
    <tbody>
      <tr>
        <td><strong>購入者</strong></td>
        <td><%= @order.customer.last_name %><%= @order.customer.first_name %></td>
      </tr>
      <tr>
        <td><strong>注文日</strong></td>
        <td><%= @order.created_at.strftime("%Y/%m/%d") %></td>
      </tr>
      <tr>
        <td><strong>配送先</strong></td>
        <td>
          〒<%= @order.postal_code %>
          <%= @order.address %><br>
          <%= @order.name %>
        </td>
      </tr>
      <tr>
        <td>支払方法</td>
        <td><%= @order.payment_i18n %></td>
      </tr>
      <tr>
        <td><strong>注文ステータス</strong></td>
        <td>
          <%= form_with model: @order, url: admin_order_path(@order.id) do |f| %>
            <%= f.select :status, [
            [Order.statuses_i18n[:waiting], :waiting],
            [Order.statuses_i18n[:confirmation], :confirmation],
            [Order.statuses_i18n[:production], :production],
            [Order.statuses_i18n[:prepartion], :prepartion],
            [Order.statuses_i18n[:sent], :sent]
            ] %>
            <%= f.submit '更新' %>
          <% end %>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div>
  <table>
    <thead>
      <tr>
        <th>商品名</th>
        <th>単価(税込)</th>
        <th>数量</th>
        <th>小計</th>
        <th>制作ステータス</th>
      </tr>
    </thead>
    <tbody>
      <% @order_products.each do |order_product| %>
      <tr>
        <td><%= order_product.item.name %></td>
        <td><%= order_product.tax_price.to_s(:delimited) %></td>
        <td><%= order_product.product_quantity %></td>
        <td>
          <% @total += order_product.subtotal %>
          <%= order_product.subtotal.to_s(:delimited) %>
        </td>
        <td>
          <%= form_with model: order_product, url: admin_order_product_path(order_product.id) do |f| %>
            <%= f.select :production_status, [
              [OrderProduct.production_statuses_i18n[:cannot_start], :cannot_start],
              [OrderProduct.production_statuses_i18n[:waiting_for_payment], :waiting_for_payment],
              [OrderProduct.production_statuses_i18n[:in_production], :in_production],
              [OrderProduct.production_statuses_i18n[:completion_of_production], :completion_of_production]
              ] %>
            <%= f.submit '更新' %>
            <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div>
  <tbody>
    <tr>
      <td><strong>商品合計</strong></td>
      <td><%= @total.to_s(:delimited) %>円</td>
    </tr>
    <tr>
      <td><strong>送料</strong></td>
      <td><%= @order.postage %>円</td>
    </tr>
    <tr>
      <td><strong>請求金額合計</strong></td>
      <td><%= (@total + @order.postage).to_s(:delinited) %>円</td>
    </tr>
  </tbody>
</div>